// Configuración de la conexión con PDO para SQL Server
$dsn = "sqlsrv:Server=$servername;Database=$dbname"; // DSN para SQL Server
$options = array(
    PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION, // Manejo de excepciones
    PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC, // Modo de obtención de resultados
);

// Crear conexión
try {
    $conn = new PDO($dsn, $username, $password, $options);
} catch (PDOException $e) {
    die("Conexión fallida: " . $e->getMessage());
}

// Verificar si los datos fueron enviados
if ($_SERVER["REQUEST_METHOD"] === "POST") {
    // Obtener los datos del formulario
    $nombre_empresa = $_POST['nombre_empresa'];
    $contacto_empresa = $_POST['contacto_empresa'];
    $nombre_proyecto = $_POST['nombre_proyecto'];
    $descripcion = $_POST['descripcion'];
    $fecha_inicio = $_POST['fecha_inicio'];
    $fecha_fin = $_POST['fecha_fin'];
    $archivo = $_POST['archivo']; // Si estás subiendo un archivo, este es el nombre del campo del formulario

    // Preparar la consulta SQL para insertar los datos
    $sql = "INSERT INTO Proyectos (nombre_empresa, contacto_empresa, nombre_proyecto, descripcion, fecha_inicio, fecha_fin, archivo) 
            VALUES (?, ?, ?, ?, ?, ?, ?)";

    try {
        // Preparar y ejecutar la sentencia
        $stmt = $conn->prepare($sql);
        $stmt->execute([$nombre_empresa, $contacto_empresa, $nombre_proyecto, $descripcion, $fecha_inicio, $fecha_fin, $archivo]);

        // Respuesta exitosa
        echo json_encode(['success' => true, 'message' => 'Datos insertados correctamente']);
    } catch (PDOException $e) {
        // Respuesta de error
        echo json_encode(['success' => false, 'message' => 'Error al insertar datos: ' . $e->getMessage()]);
    }
    
    // Cerrar la conexión (aunque PDO se cierra automáticamente cuando se destruye el objeto)
    $conn = null;
} else {
    // Si no se hizo una petición POST
    echo json_encode(['success' => false, 'message' => 'Método no permitido']);
}
?>
